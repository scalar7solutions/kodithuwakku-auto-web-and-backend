import{d as y,J as C,j as r,o as d,f as t,y as V,g as i,B as _,F as u,G as E,H as w,w as A,a as v,E as c}from"./index-CgzAhKMx.js";import S from"./SelectInputComponent2-LWIeLlKR.js";import{_ as k}from"./_plugin-vue_export-helper-DlAUqK2U.js";const x={components:{Link:y.Link,SelectInputComponent:S},props:{statsYears:{type:Array,default:()=>[]},colors:{type:Array,default:()=>[]}},data(){return{form:y.useForm({manufacturer:"",model:"",engine:"",chassis:"",grade:"",auctiongrade:"",year_from:"",year_to:"",color:""}),loading:!1,statistics:null,loadingStats:!1}},computed:{colorOptions(){return this.colors.map(s=>({id:s.COLOR,name:s.COLOR}))},isFormValid(){return this.form.manufacturer&&this.form.model&&this.form.engine},statsYears(){return this.$page.props.years||[]},yearOptions(){return this.statsYears.map(s=>({id:s.year,name:s.year}))}},mounted(){$("#manufacture, #model, #engine").on("select2:open",function(){setTimeout(function(){let s=document.querySelector(".select2-container--open .select2-search__field");s&&s.focus()},100)})},watch:{"form.manufacturer"(s,e){s!==e&&(this.form.model="",this.form.engine="")},"form.model"(s,e){s!==e&&(this.form.engine="")}},methods:{formatCurrency(s){return new Intl.NumberFormat("en-US",{style:"currency",currency:"JPY",minimumFractionDigits:0}).format(s)},onChangeField(){this.loading=!0,this.$inertia.reload({method:"POST",data:{...this.form,color:this.form.color,_method:"GET"},onSuccess:()=>this.loading=!1})},filterData(){const s={manufacturer:this.form.manufacturer,model:this.form.model,engine:this.form.engine,chassis:this.form.chassis,grade:this.form.grade,auctiongrade:this.form.auctiongrade};v.get(route("export.models"),{params:s,responseType:"blob"}).then(e=>{console.log(e);const f=new Blob([e.data],{type:e.headers["content-type"]}),m=document.createElement("a"),l=e.headers["content-disposition"];let n="download.xlsx";if(l&&l.indexOf("attachment")!==-1){const a=/filename="?(.+)"?/.exec(l);a!=null&&a[1]&&(n=a[1])}m.href=window.URL.createObjectURL(f),m.download=n,m.click(),window.URL.revokeObjectURL(m.href)}).catch(e=>{console.error("Download failed",e),alert("Download failed. Please try again.")})},viewData(){this.loadingStats=!0;const s={manufacturer:this.form.manufacturer,model:this.form.model,engine:this.form.engine,chassis:this.form.chassis,grade:this.form.grade,auctiongrade:this.form.auctiongrade,year_from:this.form.year_from,year_to:this.form.year_to,color:this.form.color,...this.form};v.get(route("view.stats"),{params:s}).then(e=>{this.statistics=e.data.statistics}).catch(e=>{console.error("Failed to load stats:",e)}).finally(()=>{this.loadingStats=!1})}}},F={key:0,class:"container py-5"},D={class:"row justify-content-center"},L={class:"col-lg-10"},R={key:0,class:"loader-wrapper"},U={key:1,class:"row g-4"},O={class:"col-md-4"},Y={class:"col-md-4"},M={class:"col-md-4"},N={class:"col-md-4"},T={class:"col-md-4"},G={class:"col-md-4"},j={class:"col-md-4"},I={class:"col-md-4"},P={class:"col-md-4"},B={class:"col-md-6 d-flex justify-content-end"},K=["disabled"],H={class:"col-md-6 d-flex justify-content-start"},J=["disabled"],Z={key:0,class:"col-lg-10 mt-5",style:{position:"relative"}},q={key:0,class:"loading-overlay"},z={class:"table-responsive"},Q={class:"table table-bordered table-striped align-middle text-center"},W={key:1,class:"flex items-center justify-center h-96 bg-gray-50"},X={class:"text-center p-8 rounded-xl shadow-md bg-white"};function ee(s,e,f,m,l,n){var p,h,g;const a=C("SelectInputComponent"),b=C("Link");return s.$root.getUser()?(d(),r("section",F,[t("div",D,[e[17]||(e[17]=t("div",{class:"col-lg-10 text-center mb-5"},[t("h2",{class:"section-title"},"Export Vehicle Statistics"),t("p",{class:"section-description"}," Select the make, model, and engine size to generate and download the auction statistics for your vehicle. ")],-1)),t("div",L,[l.loading?(d(),r("div",R,e[11]||(e[11]=[t("div",{class:"spinner"},null,-1)]))):(d(),r("div",U,[t("div",O,[i(a,{id:"manufacture",modelValue:l.form.manufacturer,"onUpdate:modelValue":e[0]||(e[0]=o=>l.form.manufacturer=o),placeholder:"Select Make",onChange:n.onChangeField,options:s.$page.props.manufactures.map(o=>({id:o.MARKA_NAME,name:o.MARKA_NAME})),class:"field-input"},null,8,["modelValue","onChange","options"])]),t("div",Y,[i(a,{id:"model",modelValue:l.form.model,"onUpdate:modelValue":e[1]||(e[1]=o=>l.form.model=o),placeholder:"Select Model",onChange:n.onChangeField,options:s.$page.props.models.map(o=>({id:o.MODEL_NAME,name:o.MODEL_NAME})),class:"field-input"},null,8,["modelValue","onChange","options"])]),t("div",M,[i(a,{id:"engine",modelValue:l.form.engine,"onUpdate:modelValue":e[2]||(e[2]=o=>l.form.engine=o),placeholder:"Engine CC",options:s.$page.props.engineCapacity.map(o=>({id:o.ENG_V,name:o.ENG_V})),class:"field-input"},null,8,["modelValue","options"])]),t("div",N,[i(a,{id:"year_from",modelValue:l.form.year_from,"onUpdate:modelValue":e[3]||(e[3]=o=>l.form.year_from=o),placeholder:"Year From",options:n.statsYears.map(o=>({id:o.YEAR,name:o.YEAR})),onChange:n.onChangeField,class:"field-input"},null,8,["modelValue","options","onChange"])]),t("div",T,[i(a,{id:"year_to",modelValue:l.form.year_to,"onUpdate:modelValue":e[4]||(e[4]=o=>l.form.year_to=o),placeholder:"Year To",options:n.statsYears.map(o=>({id:o.YEAR,name:o.YEAR})),onChange:n.onChangeField,class:"field-input"},null,8,["modelValue","options","onChange"])]),t("div",G,[i(a,{id:"auctiongrade",modelValue:l.form.auctiongrade,"onUpdate:modelValue":e[5]||(e[5]=o=>l.form.auctiongrade=o),placeholder:"SELECT Auction Grade",onChange:n.onChangeField,options:[{id:null,name:"All"},...((p=s.$page.props.auctionGrades)==null?void 0:p.map(o=>({id:o.RATE,name:o.RATE})))||[]]},null,8,["modelValue","onChange","options"])]),t("div",j,[i(a,{id:"chassis",modelValue:l.form.chassis,"onUpdate:modelValue":e[6]||(e[6]=o=>l.form.chassis=o),placeholder:"SELECT CHASSIS ID",onChange:n.onChangeField,options:[{id:null,name:"All"},...((h=s.$page.props.chassisNumbers)==null?void 0:h.map(o=>({id:o.KUZOV,name:o.KUZOV})))||[]]},null,8,["modelValue","onChange","options"])]),t("div",I,[i(a,{id:"grads",modelValue:l.form.grade,"onUpdate:modelValue":e[7]||(e[7]=o=>l.form.grade=o),placeholder:"SELECT GRADE",onChange:n.onChangeField,options:[{id:null,name:"All"},...((g=s.$page.props.grades)==null?void 0:g.map(o=>({id:o.GRADE,name:o.GRADE})))||[]]},null,8,["modelValue","onChange","options"])]),t("div",P,[i(a,{id:"color",modelValue:l.form.color,"onUpdate:modelValue":e[8]||(e[8]=o=>l.form.color=o),placeholder:"Select Colour",onChange:n.onChangeField,options:[{id:null,name:"All"},...n.colorOptions],class:"field-input"},null,8,["modelValue","onChange","options"])]),t("div",B,[t("button",{class:"btn btn-search px-4 py-2",onClick:e[9]||(e[9]=_((...o)=>n.viewData&&n.viewData(...o),["prevent"])),disabled:!n.isFormValid},e[12]||(e[12]=[t("i",{class:"fa fa-eye me-2"},null,-1),u(" View Statistics ")]),8,K)]),t("div",H,[t("button",{class:"btn btn-search px-4 py-2",onClick:e[10]||(e[10]=_((...o)=>n.filterData&&n.filterData(...o),["prevent"])),disabled:!n.isFormValid},e[13]||(e[13]=[t("i",{class:"fa fa-download me-2"},null,-1),u(" Download Vehicle List ")]),8,J)])]))]),l.statistics&&l.statistics.length?(d(),r("div",Z,[l.loadingStats?(d(),r("div",q,e[14]||(e[14]=[t("div",{class:"spinner"},null,-1)]))):V("",!0),e[16]||(e[16]=t("h4",{class:"mb-4 text-center"},"Yearly Auction Statistics",-1)),t("div",z,[t("table",Q,[e[15]||(e[15]=t("thead",{class:"table-dark"},[t("tr",null,[t("th",null,"Year"),t("th",null,"Vehicle Count"),t("th",null,"Average Price (¥)"),t("th",null,"Min Price (¥)"),t("th",null,"Max Price (¥)")])],-1)),t("tbody",null,[(d(!0),r(E,null,w(l.statistics,o=>(d(),r("tr",{key:o.year},[t("td",null,c(o.year),1),t("td",null,c(o.vehicles),1),t("td",null,c(n.formatCurrency(o.average_finish_price)),1),t("td",null,c(n.formatCurrency(o.min_price)),1),t("td",null,c(n.formatCurrency(o.max_price)),1)]))),128))])])])])):V("",!0)])])):(d(),r("section",W,[t("div",X,[e[19]||(e[19]=t("h2",{class:"text-2xl font-semibold text-gray-800 mb-4"}," Please log in ",-1)),e[20]||(e[20]=t("p",{class:"text-gray-600 mb-6"}," You need to be logged in to view your statistics and insights. ",-1)),i(b,{href:s.route("user.login",{redirect:s.$page.url}),class:"btn btn-primary"},{default:A(()=>e[18]||(e[18]=[u(" Login ")])),_:1,__:[18]},8,["href"])])]))}const le=k(x,[["render",ee],["__scopeId","data-v-94a7609a"]]);export{le as default};
