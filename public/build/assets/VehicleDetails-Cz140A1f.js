import{L as w,F as E,a as y,M as C,o as d,i as c,f as o,g as i,A as V,x as v,G as A,H as S,w as k,E as u,Q as x,R as F,J as h}from"./index-Dluosi3b.js";import D from"./SelectInputComponent2-AUthSwjy.js";import{_ as L}from"./_plugin-vue_export-helper-DlAUqK2U.js";const R={components:{Link:w,SelectInputComponent:D},props:{statsYears:{type:Array,default:()=>[]},colors:{type:Array,default:()=>[]}},data(){return{form:E({manufacturer:"",model:"",engine:"",chassis:"",grade:"",auctiongrade:"",year_from:"",year_to:"",color:""}),loading:!1,statistics:null,loadingStats:!1}},computed:{colorOptions(){return this.colors.map(s=>({id:s.COLOR,name:s.COLOR}))},isFormValid(){return this.form.manufacturer&&this.form.model&&this.form.engine},statsYears(){return this.$page.props.years||[]},yearOptions(){return this.statsYears.map(s=>({id:s.year,name:s.year}))}},mounted(){$("#manufacture, #model, #engine").on("select2:open",function(){setTimeout(function(){let s=document.querySelector(".select2-container--open .select2-search__field");s&&s.focus()},100)})},watch:{"form.manufacturer"(s,t){s!==t&&(this.form.model="",this.form.engine="")},"form.model"(s,t){s!==t&&(this.form.engine="")}},methods:{formatCurrency(s){return new Intl.NumberFormat("en-US",{style:"currency",currency:"JPY",minimumFractionDigits:0}).format(s)},onChangeField(){this.loading=!0,this.$inertia.reload({method:"POST",data:{...this.form,color:this.form.color,_method:"GET"},onSuccess:()=>this.loading=!1})},filterData(){const s={manufacturer:this.form.manufacturer,model:this.form.model,engine:this.form.engine,chassis:this.form.chassis,grade:this.form.grade,auctiongrade:this.form.auctiongrade};y.get(route("export.models"),{params:s,responseType:"blob"}).then(t=>{console.log(t);const f=new Blob([t.data],{type:t.headers["content-type"]}),m=document.createElement("a"),n=t.headers["content-disposition"];let l="download.xlsx";if(n&&n.indexOf("attachment")!==-1){const a=/filename="?(.+)"?/.exec(n);a!=null&&a[1]&&(l=a[1])}m.href=window.URL.createObjectURL(f),m.download=l,m.click(),window.URL.revokeObjectURL(m.href)}).catch(t=>{console.error("Download failed",t),alert("Download failed. Please try again.")})},viewData(){this.loadingStats=!0;const s={manufacturer:this.form.manufacturer,model:this.form.model,engine:this.form.engine,chassis:this.form.chassis,grade:this.form.grade,auctiongrade:this.form.auctiongrade,year_from:this.form.year_from,year_to:this.form.year_to,color:this.form.color,...this.form};y.get(route("view.stats"),{params:s}).then(t=>{this.statistics=t.data.statistics}).catch(t=>{console.error("Failed to load stats:",t)}).finally(()=>{this.loadingStats=!1})}}},r=s=>(x("data-v-94a7609a"),s=s(),F(),s),U={key:0,class:"container py-5"},O={class:"row justify-content-center"},Y=r(()=>o("div",{class:"col-lg-10 text-center mb-5"},[o("h2",{class:"section-title"},"Export Vehicle Statistics"),o("p",{class:"section-description"}," Select the make, model, and engine size to generate and download the auction statistics for your vehicle. ")],-1)),M={class:"col-lg-10"},N={key:0,class:"loader-wrapper"},T=r(()=>o("div",{class:"spinner"},null,-1)),I=[T],G={key:1,class:"row g-4"},P={class:"col-md-4"},j={class:"col-md-4"},B={class:"col-md-4"},K={class:"col-md-4"},H={class:"col-md-4"},J={class:"col-md-4"},Z={class:"col-md-4"},q={class:"col-md-4"},z={class:"col-md-4"},Q={class:"col-md-6 d-flex justify-content-end"},W=["disabled"],X=r(()=>o("i",{class:"fa fa-eye me-2"},null,-1)),ee=h(" View Statistics "),oe=[X,ee],te={class:"col-md-6 d-flex justify-content-start"},se=["disabled"],ne=r(()=>o("i",{class:"fa fa-download me-2"},null,-1)),le=h(" Download Vehicle List "),ae=[ne,le],ie={key:0,class:"col-lg-10 mt-5",style:{position:"relative"}},re={key:0,class:"loading-overlay"},de=r(()=>o("div",{class:"spinner"},null,-1)),ce=[de],me=r(()=>o("h4",{class:"mb-4 text-center"},"Yearly Auction Statistics",-1)),ue={class:"table-responsive"},he={class:"table table-bordered table-striped align-middle text-center"},fe=r(()=>o("thead",{class:"table-dark"},[o("tr",null,[o("th",null,"Year"),o("th",null,"Vehicle Count"),o("th",null,"Average Price (¥)"),o("th",null,"Min Price (¥)"),o("th",null,"Max Price (¥)")])],-1)),pe={key:1,class:"flex items-center justify-center h-96 bg-gray-50"},ge={class:"text-center p-8 rounded-xl shadow-md bg-white"},_e=r(()=>o("h2",{class:"text-2xl font-semibold text-gray-800 mb-4"}," Please log in ",-1)),ye=r(()=>o("p",{class:"text-gray-600 mb-6"}," You need to be logged in to view your statistics and insights. ",-1)),Ce=h(" Login ");function Ve(s,t,f,m,n,l){var p,g,_;const a=C("SelectInputComponent"),b=C("Link");return s.$root.getUser()?(d(),c("section",U,[o("div",O,[Y,o("div",M,[n.loading?(d(),c("div",N,I)):(d(),c("div",G,[o("div",P,[i(a,{id:"manufacture",modelValue:n.form.manufacturer,"onUpdate:modelValue":t[0]||(t[0]=e=>n.form.manufacturer=e),placeholder:"Select Make",onChange:l.onChangeField,options:s.$page.props.manufactures.map(e=>({id:e.MARKA_NAME,name:e.MARKA_NAME})),class:"field-input"},null,8,["modelValue","onChange","options"])]),o("div",j,[i(a,{id:"model",modelValue:n.form.model,"onUpdate:modelValue":t[1]||(t[1]=e=>n.form.model=e),placeholder:"Select Model",onChange:l.onChangeField,options:s.$page.props.models.map(e=>({id:e.MODEL_NAME,name:e.MODEL_NAME})),class:"field-input"},null,8,["modelValue","onChange","options"])]),o("div",B,[i(a,{id:"engine",modelValue:n.form.engine,"onUpdate:modelValue":t[2]||(t[2]=e=>n.form.engine=e),placeholder:"Engine CC",options:s.$page.props.engineCapacity.map(e=>({id:e.ENG_V,name:e.ENG_V})),class:"field-input"},null,8,["modelValue","options"])]),o("div",K,[i(a,{id:"year_from",modelValue:n.form.year_from,"onUpdate:modelValue":t[3]||(t[3]=e=>n.form.year_from=e),placeholder:"Year From",options:l.statsYears.map(e=>({id:e.YEAR,name:e.YEAR})),onChange:l.onChangeField,class:"field-input"},null,8,["modelValue","options","onChange"])]),o("div",H,[i(a,{id:"year_to",modelValue:n.form.year_to,"onUpdate:modelValue":t[4]||(t[4]=e=>n.form.year_to=e),placeholder:"Year To",options:l.statsYears.map(e=>({id:e.YEAR,name:e.YEAR})),onChange:l.onChangeField,class:"field-input"},null,8,["modelValue","options","onChange"])]),o("div",J,[i(a,{id:"auctiongrade",modelValue:n.form.auctiongrade,"onUpdate:modelValue":t[5]||(t[5]=e=>n.form.auctiongrade=e),placeholder:"SELECT Auction Grade",onChange:l.onChangeField,options:[{id:null,name:"All"},...((p=s.$page.props.auctionGrades)==null?void 0:p.map(e=>({id:e.RATE,name:e.RATE})))||[]]},null,8,["modelValue","onChange","options"])]),o("div",Z,[i(a,{id:"chassis",modelValue:n.form.chassis,"onUpdate:modelValue":t[6]||(t[6]=e=>n.form.chassis=e),placeholder:"SELECT CHASSIS ID",onChange:l.onChangeField,options:[{id:null,name:"All"},...((g=s.$page.props.chassisNumbers)==null?void 0:g.map(e=>({id:e.KUZOV,name:e.KUZOV})))||[]]},null,8,["modelValue","onChange","options"])]),o("div",q,[i(a,{id:"grads",modelValue:n.form.grade,"onUpdate:modelValue":t[7]||(t[7]=e=>n.form.grade=e),placeholder:"SELECT GRADE",onChange:l.onChangeField,options:[{id:null,name:"All"},...((_=s.$page.props.grades)==null?void 0:_.map(e=>({id:e.GRADE,name:e.GRADE})))||[]]},null,8,["modelValue","onChange","options"])]),o("div",z,[i(a,{id:"color",modelValue:n.form.color,"onUpdate:modelValue":t[8]||(t[8]=e=>n.form.color=e),placeholder:"Select Colour",onChange:l.onChangeField,options:[{id:null,name:"All"},...l.colorOptions],class:"field-input"},null,8,["modelValue","onChange","options"])]),o("div",Q,[o("button",{class:"btn btn-search px-4 py-2",onClick:t[9]||(t[9]=V((...e)=>l.viewData&&l.viewData(...e),["prevent"])),disabled:!l.isFormValid},oe,8,W)]),o("div",te,[o("button",{class:"btn btn-search px-4 py-2",onClick:t[10]||(t[10]=V((...e)=>l.filterData&&l.filterData(...e),["prevent"])),disabled:!l.isFormValid},ae,8,se)])]))]),n.statistics&&n.statistics.length?(d(),c("div",ie,[n.loadingStats?(d(),c("div",re,ce)):v("",!0),me,o("div",ue,[o("table",he,[fe,o("tbody",null,[(d(!0),c(A,null,S(n.statistics,e=>(d(),c("tr",{key:e.year},[o("td",null,u(e.year),1),o("td",null,u(e.vehicles),1),o("td",null,u(l.formatCurrency(e.average_finish_price)),1),o("td",null,u(l.formatCurrency(e.min_price)),1),o("td",null,u(l.formatCurrency(e.max_price)),1)]))),128))])])])])):v("",!0)])])):(d(),c("section",pe,[o("div",ge,[_e,ye,i(b,{href:s.route("user.login",{redirect:s.$page.url}),class:"btn btn-primary"},{default:k(()=>[Ce]),_:1},8,["href"])])]))}const Ee=L(R,[["render",Ve],["__scopeId","data-v-94a7609a"]]);export{Ee as default};
